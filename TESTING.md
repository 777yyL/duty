# 前后端接口联调测试指南

## 测试前准备

### 1. 数据库准备
```bash
# 创建数据库
createdb duty

# 执行数据库脚本
psql -d duty -f backend/src/main/resources/db/schema.sql
```

### 2. 启动后端服务
```bash
cd backend
mvn clean install
mvn spring-boot:run
```

后端服务启动后访问：
- 服务地址: http://localhost:8080/api
- Swagger文档: http://localhost:8080/api/swagger-ui.html

### 3. 启动前端服务
```bash
cd fronted
npm install
npm run dev
```

前端服务启动后访问：http://localhost:3000

---

## 测试流程

### 阶段一：班次配置测试

**测试步骤：**

1. **访问班次配置页面**
   - 点击左侧菜单"班次配置"
   - 检查是否显示默认的3个班次（夜班、白班、晚班）

2. **测试新增班次**
   - 点击"新增班次"按钮
   - 填写表单：
     - 班次名称：测试班次
     - 班次代码：TEST_SHIFT
     - 开始时间：06:00
     - 结束时间：12:00
     - 排序：4
     - 状态：启用
   - 点击"确定"
   - ✅ 预期：列表中新增一条记录

3. **测试编辑班次**
   - 点击刚创建的"测试班次"的"编辑"按钮
   - 修改班次名称为"早班测试"
   - 点击"确定"
   - ✅ 预期：记录更新成功

4. **测试删除班次**
   - 点击"测试班次"的"删除"按钮
   - 确认删除
   - ✅ 预期：记录被删除

**接口调用：**
- GET /api/shift/list/enabled
- POST /api/shift
- PUT /api/shift
- DELETE /api/shift/{id}

---

### 阶段二：记录模板配置测试

**测试步骤：**

1. **访问模板配置页面**
   - 点击左侧菜单"记录模板配置"
   - 检查是否显示默认的5个模板类别

2. **测试新增模板**
   - 点击"新增模板"按钮
   - 填写表单：
     - 类别名称：设施检查
     - 类别代码：FACILITY_CHECK
     - 字段描述：消防设施、监控设备等检查情况
     - 输入类型：多行文本
     - 是否必填：是
     - 排序：6
   - 点击"确定"
   - ✅ 预期：列表中新增一条记录

3. **测试编辑和删除**
   - 重复类似班次配置的测试

**接口调用：**
- GET /api/template/list/enabled
- POST /api/template
- PUT /api/template
- DELETE /api/template/{id}

---

### 阶段三：值班表管理测试

**测试步骤：**

1. **访问值班表页面**
   - 点击左侧菜单"值班表管理"
   - 检查是否显示当前月份的日历视图
   - 检查是否显示所有班次

2. **测试添加排班**
   - 点击"添加排班"按钮
   - 填写表单：
     - 值班日期：选择今天
     - 班次：白班
     - 人员搜索：输入"张"，选择"张三"
     - 可以继续添加多个人员
   - 点击"确定"
   - ✅ 预期：日历中对应日期显示排班信息

3. **测试填写值班记录**
   - 在日历中找到刚才添加的排班
   - 点击"填写记录"按钮
   - 填写各类别的记录内容
   - 点击"保存"
   - ✅ 预期：保存成功，显示"已填写"标签

4. **测试查看和编辑记录**
   - 点击"查看"按钮
   - ✅ 预期：显示已填写的记录详情
   - 可以修改内容后保存

5. **测试取消排班**
   - 点击排班记录的"..."菜单
   - 选择"取消排班"
   - ✅ 预期：排班状态变为取消

6. **测试删除排班**
   - 点击"删除"
   - 确认删除
   - ✅ 预期：排班被删除

**接口调用：**
- GET /api/schedule/month/{year}/{month}
- GET /api/schedule/person/search
- POST /api/schedule/batch
- GET /api/record/schedule/{scheduleId}
- POST /api/record
- PUT /api/record/{id}
- PUT /api/schedule/cancel/{id}
- DELETE /api/schedule/{id}

---

### 阶段四：值班记录查询测试

**测试步骤：**

1. **访问值班记录页面**
   - 点击左侧菜单"值班记录查询"
   - 检查是否显示已填写的值班记录列表

2. **测试查询功能**
   - 输入人员姓名"张三"
   - 选择日期范围
   - 点击"查询"
   - ✅ 预期：显示符合条件的记录

3. **测试查看详情**
   - 点击某条记录的"查看详情"按钮
   - ✅ 预期：显示完整的记录信息和工作日志

4. **测试导出Word**
   - 点击"导出"按钮
   - ✅ 预期：浏览器下载Word文档

5. **测试删除记录**
   - 点击"删除"按钮
   - 确认删除
   - ✅ 预期：记录被删除

**接口调用：**
- GET /api/record/page
- GET /api/record/{id}
- GET /api/export/record/{recordId}
- DELETE /api/record/{id}

---

## 常见问题排查

### 1. 跨域问题
**症状**：前端控制台显示CORS错误

**解决方案**：
- 检查后端CorsConfig配置是否正确
- 确认后端服务已启动
- 检查前端vite.config.ts中的proxy配置

### 2. 接口404错误
**症状**：调用接口返回404

**解决方案**：
- 确认后端服务启动端口是否为8080
- 检查application.yml中的context-path配置
- 确认接口路径是否正确（包含/api前缀）

### 3. 数据库连接失败
**症状**：后端启动报错，无法连接数据库

**解决方案**：
- 确认PostgreSQL服务已启动
- 检查数据库配置（用户名、密码、数据库名）
- 确认数据库schema已执行

### 4. Swagger无法访问
**症状**：访问swagger-ui.html失败

**解决方案**：
- 确认pom.xml中已添加swagger依赖
- 检查application.yml中是否配置了路径匹配策略
- 查看后端日志确认启动无异常

---

## 测试检查清单

### 班次配置
- [ ] 页面正常加载
- [ ] 新增班次成功
- [ ] 编辑班次成功
- [ ] 删除班次成功
- [ ] 表单验证生效

### 记录模板配置
- [ ] 页面正常加载
- [ ] 新增模板成功
- [ ] 编辑模板成功
- [ ] 删除模板成功
- [ ] 不同输入类型显示正确

### 值班表管理
- [ ] 日历视图正常显示
- [ ] 添加排班成功
- [ ] 人员搜索功能正常
- [ ] 填写值班记录成功
- [ ] 查看/编辑记录正常
- [ ] 取消排班功能正常
- [ ] 删除排班功能正常

### 值班记录查询
- [ ] 列表正常显示
- [ ] 查询功能正常
- [ ] 查看详情功能正常
- [ ] 导出Word功能正常
- [ ] 删除记录功能正常
- [ ] 分页功能正常

---

## 性能测试

### 并发测试
使用JMeter或类似工具进行并发测试：
- 100个并发用户查询班次列表
- 50个并发用户添加排班
- 预期：响应时间 < 2s，无错误

### 数据量测试
- 添加1000条排班记录
- 查询性能是否正常
- 日历视图渲染是否流畅

---

## 完成标准

所有测试用例通过，且：
1. 无控制台错误
2. 所有API调用正常返回
3. 页面交互流畅
4. 数据持久化正确
5. Word文档可正常下载和打开

测试完成后，系统即可投入试运行！
