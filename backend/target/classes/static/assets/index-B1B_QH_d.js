import{r as g}from"./request-DvWMyphm.js";import{d as Y,r as p,v as ee,i as le,h as e,e as t,f as n,E as v,l as te,m as ae,b as B,o as u,t as U,k as b,n as oe,x as ne,p as A,_ as re}from"./index-CM2DhkoH.js";const V={listEnabled(){return g({url:"/template/list/enabled",method:"get"})},getById(i){return g({url:`/template/${i}`,method:"get"})},save(i){return g({url:"/template",method:"post",data:i})},update(i){return g({url:"/template",method:"put",data:i})},delete(i){return g({url:`/template/${i}`,method:"delete"})}},ue={class:"template-container"},de={class:"card-header"},se={class:"dialog-footer"},ie=Y({__name:"index",setup(i){const T=p([]),E=p(!1),m=p(!1),w=p(""),C=p(!1),k=p(),o=p({categoryName:"",categoryCode:"",fieldDescription:"",defaultValue:"",inputType:"TEXT",options:"",isRequired:0,sortOrder:0,status:1,remark:""}),S={categoryName:[{required:!0,message:"请输入类别名称",trigger:"blur"},{min:2,max:100,message:"类别名称长度在 2 到 100 个字符",trigger:"blur"}],categoryCode:[{required:!0,message:"请输入类别代码",trigger:"blur"},{pattern:/^[A-Z_]+$/,message:"类别代码只能包含大写字母和下划线",trigger:"blur"}],fieldDescription:[{required:!0,message:"请输入字段描述",trigger:"blur"}],inputType:[{required:!0,message:"请选择输入类型",trigger:"change"}]},X=r=>({TEXT:"单行文本",TEXTAREA:"多行文本",SELECT:"下拉选择"})[r]||r,$=r=>({TEXT:"",TEXTAREA:"success",SELECT:"warning"})[r]||"",x=async()=>{E.value=!0;try{const r=await V.listEnabled();T.value=r||[]}catch(r){console.error("加载数据失败:",r),v.error("加载数据失败")}finally{E.value=!1}},I=()=>{w.value="新增模板",o.value={categoryName:"",categoryCode:"",fieldDescription:"",defaultValue:"",inputType:"TEXT",options:"",isRequired:0,sortOrder:T.value.length,status:1,remark:""},m.value=!0},L=r=>{w.value="编辑模板",o.value={...r},m.value=!0},h=r=>{ne.confirm(`确定要删除模板"${r.categoryName}"吗？删除后不可恢复！`,"删除确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{try{await V.delete(r.id),v.success("删除成功"),x()}catch(l){console.error("删除失败:",l)}}).catch(()=>{})},z=async()=>{k.value&&await k.value.validate(async r=>{if(r){C.value=!0;try{o.value.id?(await V.update(o.value),v.success("更新成功")):(await V.save(o.value),v.success("新增成功")),m.value=!1,x()}catch(l){console.error("提交失败:",l),v.error(l.message||"操作失败")}finally{C.value=!1}}})};return ee(()=>{x()}),(r,l)=>{const M=n("Plus"),D=n("el-icon"),_=n("el-button"),s=n("el-table-column"),N=n("el-tag"),J=n("Edit"),P=n("Delete"),Z=n("el-table"),j=n("el-card"),f=n("el-input"),d=n("el-form-item"),c=n("el-col"),q=n("el-row"),R=n("el-option"),F=n("el-select"),y=n("el-radio"),O=n("el-radio-group"),G=n("el-input-number"),H=n("el-form"),K=n("el-dialog"),Q=ae("loading");return A(),le("div",ue,[e(j,null,{header:t(()=>[b("div",de,[l[13]||(l[13]=b("span",{class:"title"},"记录模板配置",-1)),e(_,{type:"primary",onClick:I},{default:t(()=>[e(D,null,{default:t(()=>[e(M)]),_:1}),l[12]||(l[12]=u(" 新增模板 ",-1))]),_:1})])]),default:t(()=>[te((A(),B(Z,{data:T.value,border:"",stripe:""},{default:t(()=>[e(s,{type:"index",label:"序号",width:"60",align:"center"}),e(s,{prop:"categoryName",label:"类别名称","min-width":"150"}),e(s,{prop:"categoryCode",label:"类别代码","min-width":"120"}),e(s,{prop:"fieldDescription",label:"字段描述","min-width":"200","show-overflow-tooltip":""}),e(s,{label:"输入类型",width:"120",align:"center"},{default:t(({row:a})=>[e(N,{type:$(a.inputType)},{default:t(()=>[u(U(X(a.inputType)),1)]),_:2},1032,["type"])]),_:1}),e(s,{label:"必填",width:"80",align:"center"},{default:t(({row:a})=>[e(N,{type:a.isRequired===1?"danger":"info",size:"small"},{default:t(()=>[u(U(a.isRequired===1?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"sortOrder",label:"排序",width:"80",align:"center"}),e(s,{label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[e(N,{type:a.status===1?"success":"danger"},{default:t(()=>[u(U(a.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(s,{label:"操作",width:"180",fixed:"right",align:"center"},{default:t(({row:a})=>[e(_,{link:"",type:"primary",size:"small",onClick:W=>L(a)},{default:t(()=>[e(D,null,{default:t(()=>[e(J)]),_:1}),l[14]||(l[14]=u(" 编辑 ",-1))]),_:1},8,["onClick"]),e(_,{link:"",type:"danger",size:"small",onClick:W=>h(a)},{default:t(()=>[e(D,null,{default:t(()=>[e(P)]),_:1}),l[15]||(l[15]=u(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,E.value]])]),_:1}),e(K,{modelValue:m.value,"onUpdate:modelValue":l[11]||(l[11]=a=>m.value=a),title:w.value,width:"700px","close-on-click-modal":!1},{footer:t(()=>[b("span",se,[e(_,{onClick:l[10]||(l[10]=a=>m.value=!1)},{default:t(()=>[...l[21]||(l[21]=[u("取消",-1)])]),_:1}),e(_,{type:"primary",onClick:z,loading:C.value},{default:t(()=>[...l[22]||(l[22]=[u(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:t(()=>[e(H,{model:o.value,rules:S,ref_key:"formRef",ref:k,"label-width":"110px"},{default:t(()=>[e(q,{gutter:20},{default:t(()=>[e(c,{span:12},{default:t(()=>[e(d,{label:"类别名称",prop:"categoryName"},{default:t(()=>[e(f,{modelValue:o.value.categoryName,"onUpdate:modelValue":l[0]||(l[0]=a=>o.value.categoryName=a),placeholder:"如：留置对象",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:t(()=>[e(d,{label:"类别代码",prop:"categoryCode"},{default:t(()=>[e(f,{modelValue:o.value.categoryCode,"onUpdate:modelValue":l[1]||(l[1]=a=>o.value.categoryCode=a),placeholder:"如：DETENTION",clearable:"",disabled:!!o.value.id},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(d,{label:"字段描述",prop:"fieldDescription"},{default:t(()=>[e(f,{modelValue:o.value.fieldDescription,"onUpdate:modelValue":l[2]||(l[2]=a=>o.value.fieldDescription=a),placeholder:"对该字段的说明，如：当前留置对象人数及基本情况",clearable:""},null,8,["modelValue"])]),_:1}),e(q,{gutter:20},{default:t(()=>[e(c,{span:12},{default:t(()=>[e(d,{label:"输入类型",prop:"inputType"},{default:t(()=>[e(F,{modelValue:o.value.inputType,"onUpdate:modelValue":l[3]||(l[3]=a=>o.value.inputType=a),placeholder:"请选择",style:{width:"100%"}},{default:t(()=>[e(R,{label:"单行文本",value:"TEXT"}),e(R,{label:"多行文本",value:"TEXTAREA"}),e(R,{label:"下拉选择",value:"SELECT"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:t(()=>[e(d,{label:"是否必填",prop:"isRequired"},{default:t(()=>[e(O,{modelValue:o.value.isRequired,"onUpdate:modelValue":l[4]||(l[4]=a=>o.value.isRequired=a)},{default:t(()=>[e(y,{label:1},{default:t(()=>[...l[16]||(l[16]=[u("必填",-1)])]),_:1}),e(y,{label:0},{default:t(()=>[...l[17]||(l[17]=[u("非必填",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{label:"默认值",prop:"defaultValue"},{default:t(()=>[e(f,{modelValue:o.value.defaultValue,"onUpdate:modelValue":l[5]||(l[5]=a=>o.value.defaultValue=a),type:"textarea",rows:2,placeholder:"填写记录时自动填充的默认内容"},null,8,["modelValue"])]),_:1}),o.value.inputType==="SELECT"?(A(),B(d,{key:0,label:"选项配置",prop:"options"},{default:t(()=>[e(f,{modelValue:o.value.options,"onUpdate:modelValue":l[6]||(l[6]=a=>o.value.options=a),type:"textarea",rows:3,placeholder:'JSON格式，如：["选项1", "选项2", "选项3"]'},null,8,["modelValue"]),l[18]||(l[18]=b("div",{class:"form-tip"},' 仅当输入类型为"下拉选择"时需要配置，格式为JSON数组 ',-1))]),_:1})):oe("",!0),e(q,{gutter:20},{default:t(()=>[e(c,{span:12},{default:t(()=>[e(d,{label:"排序",prop:"sortOrder"},{default:t(()=>[e(G,{modelValue:o.value.sortOrder,"onUpdate:modelValue":l[7]||(l[7]=a=>o.value.sortOrder=a),min:0,max:999,step:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:t(()=>[e(d,{label:"状态",prop:"status"},{default:t(()=>[e(O,{modelValue:o.value.status,"onUpdate:modelValue":l[8]||(l[8]=a=>o.value.status=a)},{default:t(()=>[e(y,{label:1},{default:t(()=>[...l[19]||(l[19]=[u("启用",-1)])]),_:1}),e(y,{label:0},{default:t(()=>[...l[20]||(l[20]=[u("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(d,{label:"备注",prop:"remark"},{default:t(()=>[e(f,{modelValue:o.value.remark,"onUpdate:modelValue":l[9]||(l[9]=a=>o.value.remark=a),type:"textarea",rows:2,placeholder:"备注信息（选填）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),fe=re(ie,[["__scopeId","data-v-e9d770a1"]]);export{fe as default};
