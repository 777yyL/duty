import{r as w}from"./record-DJR9TiFd.js";import{d as X,r as u,a as Z,v as ee,i as y,h as e,e as l,f as o,E as b,l as Y,k as x,m as te,b as le,o as s,t as d,n as ae,F as ne,j as oe,x as se,p as g,_ as re}from"./index-CM2DhkoH.js";import"./request-DvWMyphm.js";const ie={class:"record-container"},de={class:"pagination"},ue={key:0},ce={class:"detail-list"},pe={class:"detail-label"},me={class:"detail-content"},_e=X({__name:"index",setup(fe){const h=u(!1),z=u([]),_=u({personName:"",startDate:"",endDate:""}),c=u([]),r=u({current:1,size:10,total:0}),D=u(!1),C=u(!1),i=u(null),E=Z(()=>{const n={current:r.value.current,size:r.value.size};return _.value.personName&&(n.personName=_.value.personName),c.value&&c.value.length===2&&(n.startDate=c.value[0],n.endDate=c.value[1]),n}),f=async()=>{h.value=!0;try{const n=await w.page(E.value);z.value=n.records||[],r.value.total=n.total||0}catch(n){console.error("加载数据失败:",n),b.error("加载数据失败")}finally{h.value=!1}},M=()=>{r.value.current=1,f()},$=()=>{_.value={personName:"",startDate:"",endDate:""},c.value=[],r.value.current=1,f()},L=async n=>{D.value=!0,C.value=!0;try{const t=await w.getDetailById(n.id);i.value=t}catch(t){console.error("加载详情失败:",t),b.error("加载详情失败")}finally{C.value=!1}},N=n=>{if(!n||!n.id){b.warning("请选择要导出的记录");return}const t=w.exportSingle(n.id);window.open(t,"_blank"),b.success("正在导出，请稍候...")},U=n=>{se.confirm(`确定要删除${n.dutyDate} ${n.personName}的值班记录吗？`,"删除确认",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{try{await w.delete(n.id),b.success("删除成功"),f()}catch(t){console.error("删除失败:",t)}})};return ee(()=>{f()}),(n,t)=>{const R=o("el-input"),V=o("el-form-item"),F=o("el-date-picker"),j=o("Search"),v=o("el-icon"),p=o("el-button"),q=o("RefreshLeft"),I=o("el-form"),m=o("el-table-column"),P=o("View"),S=o("Download"),A=o("Delete"),W=o("el-table"),G=o("el-pagination"),H=o("el-card"),k=o("el-descriptions-item"),J=o("el-descriptions"),K=o("el-divider"),O=o("el-tag"),Q=o("el-dialog"),T=te("loading");return g(),y("div",ie,[e(H,null,{header:l(()=>[e(I,{inline:!0,model:_.value,class:"search-form"},{default:l(()=>[e(V,{label:"人员姓名"},{default:l(()=>[e(R,{modelValue:_.value.personName,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value.personName=a),placeholder:"请输入人员姓名",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),e(V,{label:"值班日期"},{default:l(()=>[e(F,{modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=a=>c.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"280px"}},null,8,["modelValue"])]),_:1}),e(V,null,{default:l(()=>[e(p,{type:"primary",onClick:M},{default:l(()=>[e(v,null,{default:l(()=>[e(j)]),_:1}),t[7]||(t[7]=s(" 查询 ",-1))]),_:1}),e(p,{onClick:$},{default:l(()=>[e(v,null,{default:l(()=>[e(q)]),_:1}),t[8]||(t[8]=s(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),default:l(()=>[Y((g(),le(W,{data:z.value,border:"",stripe:""},{default:l(()=>[e(m,{type:"index",label:"序号",width:"60",align:"center"}),e(m,{prop:"dutyDate",label:"值班日期",width:"120"}),e(m,{prop:"personName",label:"姓名",width:"100"}),e(m,{label:"值班时间",width:"180"},{default:l(({row:a})=>[s(d(a.shiftStartTime)+" - "+d(a.shiftEndTime),1)]),_:1}),e(m,{prop:"workLogSummary",label:"工作日志","min-width":"300","show-overflow-tooltip":""}),e(m,{prop:"recordTime",label:"填写时间",width:"160"}),e(m,{label:"操作",width:"220",fixed:"right",align:"center"},{default:l(({row:a})=>[e(p,{link:"",type:"primary",size:"small",onClick:B=>L(a)},{default:l(()=>[e(v,null,{default:l(()=>[e(P)]),_:1}),t[9]||(t[9]=s(" 查看详情 ",-1))]),_:1},8,["onClick"]),e(p,{link:"",type:"success",size:"small",onClick:B=>N(a)},{default:l(()=>[e(v,null,{default:l(()=>[e(S)]),_:1}),t[10]||(t[10]=s(" 导出 ",-1))]),_:1},8,["onClick"]),e(p,{link:"",type:"danger",size:"small",onClick:B=>U(a)},{default:l(()=>[e(v,null,{default:l(()=>[e(A)]),_:1}),t[11]||(t[11]=s(" 删除 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,h.value]]),x("div",de,[e(G,{"current-page":r.value.current,"onUpdate:currentPage":t[2]||(t[2]=a=>r.value.current=a),"page-size":r.value.size,"onUpdate:pageSize":t[3]||(t[3]=a=>r.value.size=a),"page-sizes":[10,20,50,100],total:r.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])])]),_:1}),e(Q,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=a=>D.value=a),title:"值班记录详情",width:"900px"},{footer:l(()=>[e(p,{onClick:t[4]||(t[4]=a=>D.value=!1)},{default:l(()=>[...t[13]||(t[13]=[s("关闭",-1)])]),_:1}),e(p,{type:"primary",onClick:t[5]||(t[5]=a=>N(i.value)),disabled:!i.value},{default:l(()=>[e(v,null,{default:l(()=>[e(S)]),_:1}),t[14]||(t[14]=s(" 导出Word ",-1))]),_:1},8,["disabled"])]),default:l(()=>[Y((g(),y("div",null,[i.value?(g(),y("div",ue,[e(J,{column:2,border:"",class:"info-section"},{default:l(()=>[e(k,{label:"值班日期"},{default:l(()=>[s(d(i.value.dutyDate),1)]),_:1}),e(k,{label:"值班人员"},{default:l(()=>[s(d(i.value.personName),1)]),_:1}),e(k,{label:"值班时段"},{default:l(()=>[s(d(i.value.shiftStartTime)+" - "+d(i.value.shiftEndTime),1)]),_:1}),e(k,{label:"填写时间"},{default:l(()=>[s(d(i.value.recordTime),1)]),_:1})]),_:1}),e(K,{"content-position":"left"},{default:l(()=>[...t[12]||(t[12]=[s("工作日志",-1)])]),_:1}),x("div",ce,[(g(!0),y(ne,null,oe(i.value.detailList,a=>(g(),y("div",{key:a.id,class:"detail-item"},[x("div",pe,[e(O,{type:"primary",size:"small"},{default:l(()=>[s(d(a.categoryName),1)]),_:2},1024)]),x("div",me,d(a.recordContent||"（未填写）"),1)]))),128))])])):ae("",!0)])),[[T,C.value]])]),_:1},8,["modelValue"])])}}}),be=re(_e,[["__scopeId","data-v-fece8ead"]]);export{be as default};
