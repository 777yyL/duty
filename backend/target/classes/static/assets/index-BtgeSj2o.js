import{g as Ye,c as Ue,d as pe,r as m,a as ge,w as ce,b as R,e as o,f as d,h as t,i as f,j as K,F as W,k as n,l as _e,m as fe,n as X,o as $,p as r,q as me,t as V,E,_ as ve,s as De,u as te,v as Pe}from"./index-CM2DhkoH.js";import{r as Q}from"./request-DvWMyphm.js";import{r as ue}from"./record-DJR9TiFd.js";var $e={exports:{}};(function(p,L){(function(y,M){p.exports=M()})(Ue,function(){return function(y,M){M.prototype.weekday=function(C){var S=this.$locale().weekStart||0,w=this.$W,v=(w<S?w+7:w)-S;return this.$utils().u(C)?v:this.subtract(v,"day").add(C,"day")}}})})($e);var Te=$e.exports;const Me=Ye(Te),le={page(p){return Q({url:"/schedule/page",method:"get",params:p})},getMonthSchedule(p,L){return Q({url:`/schedule/month/${p}/${L}`,method:"get"})},listByDate(p){return Q({url:`/schedule/date/${p}`,method:"get"})},getById(p){return Q({url:`/schedule/${p}`,method:"get"})},saveBatch(p){return Q({url:"/schedule/batch",method:"post",data:p})},update(p){return Q({url:"/schedule",method:"put",data:p})},delete(p){return Q({url:`/schedule/${p}`,method:"delete"})},cancel(p){return Q({url:`/schedule/cancel/${p}`,method:"put"})},searchPersons(p){return Q({url:"/schedule/person/search",method:"get",params:{keyword:p}})},getDepartmentTree(){return Q({url:"/schedule/departments",method:"get"})},getPersonsByDept(p,L){return Q({url:"/schedule/person/department",method:"get",params:{deptId:p,keyword:L}})}},Ee={class:"person-selector"},Re={class:"person-list"},Be=["onClick"],ze={class:"person-info"},Fe={class:"person-details"},Le={class:"person-name"},Ae={class:"person-dept"},je={class:"selected-persons"},qe={key:0,class:"empty-tip"},Oe=pe({__name:"ScheduleDialog",props:{modelValue:{type:Boolean},shifts:{}},emits:["update:modelValue","success"],setup(p,{emit:L}){const y=p,M=L,C=m(),S=m(!1),w=m(""),v=m(!1),U=m([]),D=m([]),i=m({dutyDate:"",shiftId:void 0,remark:""}),J=ge(()=>"添加排班"),B={dutyDate:[{required:!0,message:"请选择值班日期",trigger:"change"}],shiftId:[{required:!0,message:"请选择班次",trigger:"change"}],persons:[{validator:(a,s,_)=>{D.value.length===0?_(new Error("请至少选择一名值班人员")):_()},trigger:"change"}]},z=async()=>{v.value=!0;try{const a=await le.searchPersons(w.value);U.value=a||[]}catch(a){console.error("搜索人员失败:",a)}finally{v.value=!1}},A=a=>D.value.some(s=>s.personId===a),j=a=>{const s=D.value.findIndex(_=>_.personId===a.personId);s>-1?D.value.splice(s,1):D.value.push(a)},I=a=>{const s=D.value.findIndex(_=>_.personId===a);s>-1&&D.value.splice(s,1)},h=()=>{M("update:modelValue",!1),N()},N=()=>{var a;i.value={dutyDate:"",shiftId:void 0,remark:""},w.value="",U.value=[],D.value=[],(a=C.value)==null||a.resetFields()},P=async()=>{C.value&&await C.value.validate(async a=>{if(a){S.value=!0;try{const s=D.value.map(_=>({dutyDate:i.value.dutyDate,shiftId:i.value.shiftId,personId:_.personId,personName:_.personName,personGender:_.gender,deptId:_.deptId,deptName:_.deptName,remark:i.value.remark}));await le.saveBatch(s),E.success("添加成功"),M("success"),h()}catch(s){console.error("提交失败:",s),E.error(s.message||"操作失败")}finally{S.value=!1}}})};return ce(()=>y.modelValue,a=>{a&&z()}),(a,s)=>{const _=d("el-date-picker"),T=d("el-form-item"),x=d("el-col"),F=d("el-option"),q=d("el-select"),O=d("el-row"),H=d("Search"),u=d("el-icon"),Y=d("el-input"),ne=d("User"),de=d("Check"),g=d("el-tag"),se=d("el-form"),Z=d("el-button"),ee=d("el-dialog"),re=fe("loading");return r(),R(ee,{"model-value":p.modelValue,title:J.value,width:"800px","close-on-click-modal":!1,"onUpdate:modelValue":s[4]||(s[4]=e=>a.$emit("update:modelValue",e))},{footer:o(()=>[t(Z,{onClick:h},{default:o(()=>[...s[5]||(s[5]=[$("取消",-1)])]),_:1}),t(Z,{type:"primary",onClick:P,loading:S.value},{default:o(()=>[...s[6]||(s[6]=[$(" 确定 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(se,{model:i.value,rules:B,ref_key:"formRef",ref:C,"label-width":"100px"},{default:o(()=>[t(O,{gutter:20},{default:o(()=>[t(x,{span:12},{default:o(()=>[t(T,{label:"值班日期",prop:"dutyDate"},{default:o(()=>[t(_,{modelValue:i.value.dutyDate,"onUpdate:modelValue":s[0]||(s[0]=e=>i.value.dutyDate=e),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(x,{span:12},{default:o(()=>[t(T,{label:"班次",prop:"shiftId"},{default:o(()=>[t(q,{modelValue:i.value.shiftId,"onUpdate:modelValue":s[1]||(s[1]=e=>i.value.shiftId=e),placeholder:"请选择班次",style:{width:"100%"}},{default:o(()=>[(r(!0),f(W,null,K(p.shifts,e=>(r(),R(F,{key:e.id,label:`${e.shiftName} (${e.startTime}-${e.endTime})`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(T,{label:"值班人员",prop:"persons"},{default:o(()=>[n("div",Ee,[t(Y,{modelValue:w.value,"onUpdate:modelValue":s[2]||(s[2]=e=>w.value=e),placeholder:"搜索人员（姓名或部门）",clearable:"",onInput:z},{prefix:o(()=>[t(u,null,{default:o(()=>[t(H)]),_:1})]),_:1},8,["modelValue"]),_e((r(),f("div",Re,[(r(!0),f(W,null,K(U.value,e=>(r(),f("div",{key:e.personId,class:me(["person-item",{selected:A(e.personId)}]),onClick:l=>j(e)},[n("div",ze,[t(u,null,{default:o(()=>[t(ne)]),_:1}),n("div",Fe,[n("div",Le,V(e.personName),1),n("div",Ae,V(e.deptName),1)])]),A(e.personId)?(r(),R(u,{key:0,color:"#409eff"},{default:o(()=>[t(de)]),_:1})):X("",!0)],10,Be))),128))])),[[re,v.value]]),n("div",je,[(r(!0),f(W,null,K(D.value,e=>(r(),R(g,{key:e.personId,closable:"",onClose:l=>I(e.personId)},{default:o(()=>[$(V(e.personName),1)]),_:2},1032,["onClose"]))),128)),D.value.length===0?(r(),f("span",qe," 未选择人员 ")):X("",!0)])])]),_:1}),t(T,{label:"备注",prop:"remark"},{default:o(()=>[t(Y,{modelValue:i.value.remark,"onUpdate:modelValue":s[3]||(s[3]=e=>i.value.remark=e),type:"textarea",rows:2,placeholder:"备注信息（选填）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","title"])}}}),Ge=ve(Oe,[["__scopeId","data-v-1616f7f6"]]),Ke={class:"dialog-content"},We={class:"date-display"},Xe={class:"date-text"},Je={class:"two-column-layout"},He={class:"left-panel"},Qe={class:"panel-header"},Ze={class:"shift-list"},et=["onClick"],tt={class:"shift-name"},lt={class:"shift-time"},st={class:"shift-count"},ot={class:"right-panel"},at={class:"panel-header"},nt={class:"person-selector-section"},dt={class:"selector-layout"},rt={class:"dept-tree-box"},it={class:"custom-tree-node"},ut={class:"node-label"},ct={class:"person-list-box"},mt={class:"available-persons"},pt=["onClick"],_t={class:"person-info"},ft={class:"person-details"},vt={class:"person-name"},ht={class:"person-dept"},yt={class:"selected-persons-section"},gt={class:"selected-persons-list"},kt={class:"person-info"},Vt={class:"person-details"},It={class:"person-name"},Dt={class:"person-dept"},$t={class:"person-actions"},bt={class:"remark-section"},wt=pe({__name:"DayScheduleDialog",props:{modelValue:{type:Boolean},date:{},shifts:{}},emits:["update:modelValue","success"],setup(p,{emit:L}){const y=p,M=L,C=m(),S=m(!1),w=m(!1),v=m(),U=m(!1),D=m({remark:""}),i=m({personId:"",personName:"",deptName:"",personRemark:""}),J=m(null),B=m([]),z=m([]),A=m(""),j=m(""),I=De({}),h=De({});ce(()=>y.modelValue,async e=>{e&&(y.shifts.length>0&&(v.value=y.shifts[0].id),N(),await P(),re())});const N=()=>{y.shifts.forEach(e=>{I[e.id]||(I[e.id]=[])})},P=async()=>{try{const l=await le.listByDate(y.date);y.shifts.forEach(k=>{I[k.id]=[]}),Object.keys(h).forEach(k=>{delete h[k]}),l.forEach(k=>{const b=k.shiftId;I[b]||(I[b]=[]);const G={personId:k.personId,personName:k.personName,gender:k.personGender,deptId:k.deptId,deptName:k.deptName};I[b].push(G),k.remark&&(h[k.personId+"_"+b]=k.remark)}),console.log("已加载排班数据:",l.length,"条")}catch(e){console.error("加载已有排班数据失败:",e)}},a=e=>te(e).format("YYYY年MM月DD日"),s=e=>{v.value=e},_=()=>{const e=y.shifts.find(l=>l.id===v.value);return e?e.shiftName:""},T=e=>(I[e]||[]).length,x=()=>I[v.value]||[],F=(e,l)=>e?l.deptName.includes(e):!0;ce(A,e=>{var l;(l=C.value)==null||l.filter(e)});const q=e=>{O(e.deptId)},O=async e=>{w.value=!0;try{const l=await le.getPersonsByDept(e);z.value=l||[],j.value=""}catch(l){console.error("加载部门人员失败:",l),E.error("加载部门人员失败"),z.value=[]}finally{w.value=!1}},H=()=>{},u=ge(()=>{let e=z.value;if(j.value){const b=j.value.toLowerCase();e=e.filter(G=>G.personName.toLowerCase().includes(b))}const l=I[v.value]||[],k=new Set(l.map(b=>b.personId));return e=e.filter(b=>!k.has(b.personId)),e}),Y=e=>{const l=v.value;if(I[l]||(I[l]=[]),I[l].some(b=>b.personId===e.personId)){E.warning("该人员已在当前班次中");return}I[l].push(e),E.success(`已添加 ${e.personName} 到 ${_()}`)},ne=e=>{const l=v.value;if(I[l]){const k=I[l].findIndex(b=>b.personId===e);k>-1&&(I[l].splice(k,1),delete h[e+"_"+l],E.success("已移除"))}},de=e=>{const l=v.value;J.value=e,i.value={personId:e.personId,personName:e.personName,deptName:e.deptName,personRemark:h[e.personId+"_"+l]||""},U.value=!0},g=()=>{if(J.value){const e=v.value;h[J.value.personId+"_"+e]=i.value.personRemark,E.success("保存成功"),U.value=!1}},se=()=>{M("update:modelValue",!1),Z()},Z=()=>{D.value={remark:""},A.value="",j.value="",z.value=[],y.shifts.forEach(e=>{I[e.id]=[]}),Object.keys(h).forEach(e=>{delete h[e]})},ee=async()=>{if(Object.values(I).reduce((l,k)=>l+k.length,0)===0){E.warning("请至少为某个班次选择值班人员");return}S.value=!0;try{const l=[];y.shifts.forEach(k=>{(I[k.id]||[]).forEach(G=>{l.push({dutyDate:y.date,shiftId:k.id,personId:G.personId,personName:G.personName,personGender:G.gender,deptId:G.deptId,deptName:G.deptName,remark:h[G.personId+"_"+k.id]||D.value.remark})})}),await le.saveBatch(l),E.success(`成功添加 ${l.length} 条排班记录`),M("success"),se()}catch(l){console.error("提交失败:",l),E.error(l.message||"操作失败")}finally{S.value=!1}},re=async()=>{try{const e=await le.getDepartmentTree();if(B.value=e||[],e&&e.length>0){const l=e[0];l.children&&l.children.length>0?await O(l.children[0].deptId):await O(l.deptId)}}catch(e){console.error("加载部门树失败:",e)}};return(e,l)=>{const k=d("Calendar"),b=d("el-icon"),G=d("Clock"),be=d("el-tag"),he=d("User"),ke=d("el-divider"),oe=d("el-input"),we=d("Folder"),Ce=d("el-tree"),Se=d("Plus"),Ve=d("el-empty"),ae=d("el-button"),ye=d("el-form-item"),Ne=d("el-form"),Ie=d("el-dialog"),xe=fe("loading");return r(),R(Ie,{"model-value":p.modelValue,title:"日排班 - 批量设置所有班次",width:"1100px","close-on-click-modal":!1,"onUpdate:modelValue":l[8]||(l[8]=c=>e.$emit("update:modelValue",c))},{footer:o(()=>[t(ae,{onClick:se},{default:o(()=>[...l[13]||(l[13]=[$("取消",-1)])]),_:1}),t(ae,{type:"primary",onClick:ee,loading:S.value},{default:o(()=>[...l[14]||(l[14]=[$(" 保存排班 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[n("div",Ke,[n("div",We,[t(b,null,{default:o(()=>[t(k)]),_:1}),n("span",Xe,V(a(p.date)),1)]),n("div",Je,[n("div",He,[n("div",Qe,[t(b,null,{default:o(()=>[t(G)]),_:1}),l[9]||(l[9]=n("span",null,"班次列表",-1))]),n("div",Ze,[(r(!0),f(W,null,K(p.shifts,c=>(r(),f("div",{key:c.id,class:me(["shift-item",{active:v.value===c.id}]),onClick:ie=>s(c.id)},[n("div",tt,V(c.shiftName),1),n("div",lt,V(c.startTime)+" - "+V(c.endTime),1),n("div",st,[t(be,{size:"small",type:"info"},{default:o(()=>[$(V(T(c.id))+" 人 ",1)]),_:2},1024)])],10,et))),128))])]),n("div",ot,[n("div",at,[t(b,null,{default:o(()=>[t(he)]),_:1}),n("span",null,V(_())+" - 人员管理",1)]),n("div",nt,[t(ke,{"content-position":"left"},{default:o(()=>[...l[10]||(l[10]=[$("添加人员",-1)])]),_:1}),n("div",dt,[n("div",rt,[t(oe,{modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=c=>A.value=c),placeholder:"搜索部门",clearable:"","prefix-icon":"Search",size:"small",class:"search-input"},null,8,["modelValue"]),t(Ce,{ref_key:"deptTreeRef",ref:C,data:B.value,props:{label:"deptName",children:"children"},"filter-node-method":F,"node-key":"deptId","highlight-current":"","default-expand-all":"",onNodeClick:q,class:"dept-tree"},{default:o(({node:c,data:ie})=>[n("span",it,[t(b,null,{default:o(()=>[t(we)]),_:1}),n("span",ut,V(c.label),1)])]),_:1},8,["data"])]),n("div",ct,[t(oe,{modelValue:j.value,"onUpdate:modelValue":l[1]||(l[1]=c=>j.value=c),placeholder:"搜索人员",clearable:"","prefix-icon":"Search",size:"small",onInput:H,class:"search-input"},null,8,["modelValue"]),_e((r(),f("div",mt,[(r(!0),f(W,null,K(u.value,c=>(r(),f("div",{key:c.personId,class:"person-item",onClick:ie=>Y(c)},[n("div",_t,[t(b,{class:"person-icon"},{default:o(()=>[t(he)]),_:1}),n("div",ft,[n("div",vt,V(c.personName),1),n("div",ht,V(c.deptName),1)])]),t(b,{class:"add-icon"},{default:o(()=>[t(Se)]),_:1})],8,pt))),128)),u.value.length===0?(r(),R(Ve,{key:0,description:"暂无人员","image-size":60})):X("",!0)])),[[xe,w.value]])])])]),n("div",yt,[t(ke,{"content-position":"left"},{default:o(()=>[$(" 已分配人员 ("+V(x().length)+") ",1)]),_:1}),n("div",gt,[(r(!0),f(W,null,K(x(),c=>(r(),f("div",{key:c.personId,class:"selected-person-item"},[n("div",kt,[t(b,{class:"person-icon"},{default:o(()=>[t(he)]),_:1}),n("div",Vt,[n("div",It,V(c.personName),1),n("div",Dt,V(c.deptName),1)])]),n("div",$t,[t(ae,{link:"",type:"primary",size:"small",onClick:ie=>de(c)},{default:o(()=>[...l[11]||(l[11]=[$(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(ae,{link:"",type:"danger",size:"small",onClick:ie=>ne(c.personId)},{default:o(()=>[...l[12]||(l[12]=[$(" 移除 ",-1)])]),_:1},8,["onClick"])])]))),128)),x().length===0?(r(),R(Ve,{key:0,description:"未分配人员","image-size":60})):X("",!0)])])])]),n("div",bt,[t(oe,{modelValue:D.value.remark,"onUpdate:modelValue":l[2]||(l[2]=c=>D.value.remark=c),type:"textarea",rows:2,placeholder:"备注信息（选填）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])])]),t(Ie,{modelValue:U.value,"onUpdate:modelValue":l[7]||(l[7]=c=>U.value=c),title:"编辑人员信息",width:"500px","append-to-body":""},{footer:o(()=>[t(ae,{onClick:l[6]||(l[6]=c=>U.value=!1)},{default:o(()=>[...l[15]||(l[15]=[$("取消",-1)])]),_:1}),t(ae,{type:"primary",onClick:g},{default:o(()=>[...l[16]||(l[16]=[$("保存",-1)])]),_:1})]),default:o(()=>[t(Ne,{model:i.value,"label-width":"100px"},{default:o(()=>[t(ye,{label:"姓名"},{default:o(()=>[t(oe,{modelValue:i.value.personName,"onUpdate:modelValue":l[3]||(l[3]=c=>i.value.personName=c),disabled:""},null,8,["modelValue"])]),_:1}),t(ye,{label:"部门"},{default:o(()=>[t(oe,{modelValue:i.value.deptName,"onUpdate:modelValue":l[4]||(l[4]=c=>i.value.deptName=c),disabled:""},null,8,["modelValue"])]),_:1}),t(ye,{label:"备注"},{default:o(()=>[t(oe,{modelValue:i.value.personRemark,"onUpdate:modelValue":l[5]||(l[5]=c=>i.value.personRemark=c),type:"textarea",rows:3,placeholder:"该人员本次值班的备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1},8,["model-value"])}}}),Ct=ve(wt,[["__scopeId","data-v-a0f68adb"]]),St={class:"record-content"},Nt={key:0,class:"schedule-info"},xt={class:"section-title"},Yt={key:0,class:"required-mark"},Ut={key:3,class:"default-value"},Pt=pe({__name:"RecordDialog",props:{modelValue:{type:Boolean},scheduleId:{}},emits:["update:modelValue","success"],setup(p,{emit:L}){const y=p,M=L,C=m(),S=m(!1),w=m(!1),v=m(null),U=m([]),D=m(null),i=m({details:{}}),J=m("填写值班记录"),B=h=>{if(!h)return[];try{return JSON.parse(h)}catch{return[]}},z=async()=>{if(y.scheduleId){S.value=!0;try{const h=await ue.getTemplateList();U.value=h||[];const N=await le.getById(y.scheduleId);v.value=N;try{const P=await ue.getByScheduleId(y.scheduleId);D.value=P,i.value.details={},P.detailList&&P.detailList.forEach(a=>{i.value.details[a.templateId]=a.recordContent||""}),J.value="编辑值班记录"}catch{i.value.details={},U.value.forEach(a=>{a.defaultValue?i.value.details[a.id]=a.defaultValue:i.value.details[a.id]=""}),J.value="填写值班记录"}}catch(h){console.error("加载数据失败:",h),E.error("加载数据失败")}finally{S.value=!1}}},A=()=>{M("update:modelValue",!1),j()},j=()=>{var h;i.value={details:{}},v.value=null,U.value=[],D.value=null,(h=C.value)==null||h.resetFields()},I=async()=>{C.value&&await C.value.validate(async h=>{if(h){w.value=!0;try{const N=Object.entries(i.value.details).map(([a,s])=>({templateId:Number(a),recordContent:s})),P={scheduleId:y.scheduleId,details:N};D.value?(await ue.update(D.value.id,P),E.success("更新成功")):(await ue.save(P),E.success("保存成功")),M("success"),A()}catch(N){console.error("提交失败:",N),E.error(N.message||"操作失败")}finally{w.value=!1}}})};return ce(()=>y.modelValue,h=>{h&&z()}),(h,N)=>{const P=d("el-descriptions-item"),a=d("el-descriptions"),s=d("el-input"),_=d("el-option"),T=d("el-select"),x=d("el-form-item"),F=d("el-form"),q=d("el-button"),O=d("el-dialog"),H=fe("loading");return r(),R(O,{"model-value":p.modelValue,title:J.value,width:"900px","close-on-click-modal":!1,"onUpdate:modelValue":N[0]||(N[0]=u=>h.$emit("update:modelValue",u))},{footer:o(()=>[t(q,{onClick:A},{default:o(()=>[...N[1]||(N[1]=[$("取消",-1)])]),_:1}),t(q,{type:"primary",onClick:I,loading:w.value},{default:o(()=>[...N[2]||(N[2]=[$(" 保存 ",-1)])]),_:1},8,["loading"])]),default:o(()=>[_e((r(),f("div",St,[v.value?(r(),f("div",Nt,[t(a,{column:3,border:""},{default:o(()=>[t(P,{label:"值班日期"},{default:o(()=>[$(V(v.value.dutyDate),1)]),_:1}),t(P,{label:"班次"},{default:o(()=>[$(V(v.value.shiftName)+" ("+V(v.value.shiftStartTime)+"-"+V(v.value.shiftEndTime)+") ",1)]),_:1}),t(P,{label:"值班人员"},{default:o(()=>[$(V(v.value.personName),1)]),_:1})]),_:1})])):X("",!0),t(F,{model:i.value,ref_key:"formRef",ref:C,"label-width":"120px",class:"record-form"},{default:o(()=>[(r(!0),f(W,null,K(U.value,u=>(r(),f("div",{key:u.id,class:"form-section"},[n("div",xt,[u.isRequired===1?(r(),f("span",Yt,"*")):X("",!0),$(" "+V(u.categoryName),1)]),t(x,{prop:`details.${u.id}`,rules:{required:u.isRequired===1,message:`请填写${u.categoryName}`,trigger:"blur"}},{default:o(()=>[u.inputType==="TEXT"?(r(),R(s,{key:0,modelValue:i.value.details[u.id],"onUpdate:modelValue":Y=>i.value.details[u.id]=Y,placeholder:u.fieldDescription||"请输入",clearable:""},null,8,["modelValue","onUpdate:modelValue","placeholder"])):u.inputType==="TEXTAREA"?(r(),R(s,{key:1,modelValue:i.value.details[u.id],"onUpdate:modelValue":Y=>i.value.details[u.id]=Y,type:"textarea",rows:4,placeholder:u.fieldDescription||"请输入",clearable:""},null,8,["modelValue","onUpdate:modelValue","placeholder"])):u.inputType==="SELECT"?(r(),R(T,{key:2,modelValue:i.value.details[u.id],"onUpdate:modelValue":Y=>i.value.details[u.id]=Y,placeholder:u.fieldDescription||"请选择",style:{width:"100%"},clearable:""},{default:o(()=>[(r(!0),f(W,null,K(B(u.options),Y=>(r(),R(_,{key:Y,label:Y,value:Y},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])):X("",!0),u.defaultValue?(r(),f("div",Ut," 默认值："+V(u.defaultValue),1)):X("",!0)]),_:2},1032,["prop","rules"])]))),128))]),_:1},8,["model"])])),[[H,S.value]])]),_:1},8,["model-value","title"])}}}),Tt=ve(Pt,[["__scopeId","data-v-c1569c82"]]),Mt={class:"schedule-container"},Et={class:"toolbar"},Rt={class:"left"},Bt={class:"right"},zt={class:"calendar-wrapper"},Ft={class:"calendar-header"},Lt={class:"calendar-grid"},At={class:"day-header"},jt={class:"day-number"},qt={key:0,class:"today-badge"},Ot={class:"day-content"},Gt={class:"shift-title"},Kt={class:"schedule-list"},Wt=["onClick"],Xt={class:"person-info"},Jt={class:"person-name-large"},Ht={class:"click-hint"},Qt={key:0,class:"no-schedule"},Zt=pe({__name:"index",setup(p){te.extend(Me);const L=["一","二","三","四","五","六","日"],y=m(te().format("YYYY-MM")),M=m(!1),C=m({}),S=m([]),w=m(!1),v=m(!1),U=m(!1),D=m(),i=m(""),J=ge(()=>{const a=te(y.value),s=a.year(),_=a.month(),T=te(),x=te().year(s).month(_).date(1);te().year(s).month(_).date(x.daysInMonth());const F=x.day()||7,q=x.subtract(F-1,"day"),O=6*7;q.add(O-1,"day");const H=[];let u=q;for(let Y=0;Y<O;Y++)H.push({date:u.format("YYYY-MM-DD"),day:u.date(),isCurrentMonth:u.month()===_,isToday:u.isSame(T,"day")}),u=u.add(1,"day");return H}),B=async()=>{M.value=!0;try{const[a,s]=y.value.split("-").map(Number),_=await le.getMonthSchedule(a,s);C.value=_.schedules||{},S.value=_.shifts||[]}catch(a){console.error("加载排班数据失败:",a),E.error("加载排班数据失败")}finally{M.value=!1}},z=a=>{const s=te(y.value).add(a,"month");y.value=s.format("YYYY-MM"),B()},A=(a,s)=>{var _;return((_=C.value[a])==null?void 0:_.filter(T=>T.shiftId===s))||[]},j=(a,s)=>(C.value[a]||[]).some(T=>T.shiftId===s&&T.status===1),I=a=>{i.value=a.date,v.value=!0},h=()=>{w.value=!0},N=a=>{P(a)},P=a=>{D.value=a.id,U.value=!0};return Pe(()=>{B()}),(a,s)=>{const _=d("el-date-picker"),T=d("ArrowLeft"),x=d("el-icon"),F=d("el-button"),q=d("ArrowRight"),O=d("el-button-group"),H=d("Plus"),u=d("User"),Y=d("el-tag"),ne=d("el-card"),de=fe("loading");return r(),f("div",Mt,[t(ne,null,{header:o(()=>[n("div",Et,[n("div",Rt,[t(_,{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=g=>y.value=g),type:"month",placeholder:"选择月份",format:"YYYY年MM月","value-format":"YYYY-MM",onChange:B,style:{width:"150px"}},null,8,["modelValue"]),t(O,{class:"ml-2"},{default:o(()=>[t(F,{size:"small",onClick:s[1]||(s[1]=g=>z(-1))},{default:o(()=>[t(x,null,{default:o(()=>[t(T)]),_:1}),s[8]||(s[8]=$(" 上月 ",-1))]),_:1}),t(F,{size:"small",onClick:s[2]||(s[2]=g=>z(0))},{default:o(()=>[...s[9]||(s[9]=[$("本月",-1)])]),_:1}),t(F,{size:"small",onClick:s[3]||(s[3]=g=>z(1))},{default:o(()=>[s[10]||(s[10]=$(" 下月 ",-1)),t(x,null,{default:o(()=>[t(q)]),_:1})]),_:1})]),_:1})]),n("div",Bt,[t(F,{type:"primary",onClick:s[4]||(s[4]=g=>h())},{default:o(()=>[t(x,null,{default:o(()=>[t(H)]),_:1}),s[11]||(s[11]=$(" 批量添加排班 ",-1))]),_:1})])])]),default:o(()=>[_e((r(),f("div",zt,[n("div",Ft,[(r(),f(W,null,K(L,g=>n("div",{key:g,class:"calendar-header-item"},V(g),1)),64))]),n("div",Lt,[(r(!0),f(W,null,K(J.value,(g,se)=>(r(),f("div",{key:se,class:me(["calendar-day",{"other-month":!g.isCurrentMonth},{today:g.isToday}])},[n("div",At,[n("span",jt,V(g.day),1),g.isToday?(r(),f("span",qt,"今天")):X("",!0),g.isCurrentMonth?(r(),R(F,{key:1,type:"primary",size:"small",class:"day-schedule-btn",onClick:Z=>I(g)},{default:o(()=>[t(x,null,{default:o(()=>[t(H)]),_:1}),s[12]||(s[12]=$(" 日排班 ",-1))]),_:1},8,["onClick"])):X("",!0)]),n("div",Ot,[(r(!0),f(W,null,K(S.value,Z=>(r(),f("div",{key:Z.id,class:"shift-section"},[n("div",Gt,V(Z.shiftName),1),n("div",Kt,[(r(!0),f(W,null,K(A(g.date,Z.id),ee=>(r(),f("div",{key:ee.id,class:me(["schedule-item",{cancelled:ee.status===0,"has-record":ee.hasRecord}]),onClick:re=>N(ee)},[n("div",Xt,[t(x,{class:"person-icon"},{default:o(()=>[t(u)]),_:1}),n("span",Jt,V(ee.personName),1),ee.hasRecord?(r(),R(Y,{key:0,size:"small",type:"success",class:"record-tag"},{default:o(()=>[...s[13]||(s[13]=[$(" 已填写 ",-1)])]),_:1})):X("",!0)]),n("div",Ht,[t(x,null,{default:o(()=>[t(q)]),_:1})])],10,Wt))),128)),j(g.date,Z.id)?X("",!0):(r(),f("div",Qt,[...s[14]||(s[14]=[n("span",{class:"no-data-tip"},"暂无排班",-1)])]))])]))),128))])],2))),128))])])),[[de,M.value]])]),_:1}),t(Ct,{modelValue:v.value,"onUpdate:modelValue":s[5]||(s[5]=g=>v.value=g),date:i.value,shifts:S.value,onSuccess:B},null,8,["modelValue","date","shifts"]),t(Ge,{modelValue:w.value,"onUpdate:modelValue":s[6]||(s[6]=g=>w.value=g),shifts:S.value,onSuccess:B},null,8,["modelValue","shifts"]),t(Tt,{modelValue:U.value,"onUpdate:modelValue":s[7]||(s[7]=g=>U.value=g),"schedule-id":D.value,onSuccess:B},null,8,["modelValue","schedule-id"])])}}}),sl=ve(Zt,[["__scopeId","data-v-53def5f8"]]);export{sl as default};
